

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4. GEOPROCESSAMENTO BÁSICO COM SHAPELY E FIONA &#8212; Programação para Geoprocessamento</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'capitulo4';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5 A BIBLIOTECA GEOPANDAS" href="capitulo5.html" />
    <link rel="prev" title="3. A BIBLIOTECA PANDAS" href="capitulo3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/pythongeo.png" class="logo__image only-light" alt="Programação para Geoprocessamento - Home"/>
    <script>document.write(`<img src="_static/pythongeo.png" class="logo__image only-dark" alt="Programação para Geoprocessamento - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Programação para Geoprocessamento
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="capitulo1.html">1. INTRODUÇÃO</a></li>
<li class="toctree-l1"><a class="reference internal" href="capitulo2.html">2. FUNDAMENTOS DA LINGUAGEM PYTHON</a></li>

<li class="toctree-l1"><a class="reference internal" href="capitulo3.html">3. A BIBLIOTECA PANDAS</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. GEOPROCESSAMENTO BÁSICO COM SHAPELY E FIONA</a></li>
<li class="toctree-l1"><a class="reference internal" href="capitulo5.html">5 A BIBLIOTECA GEOPANDAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="capitulo6.html">6. VISUALIZAÇÃO DE DADOS GEOESPACIAIS NO PYTHON</a></li>
<li class="toctree-l1"><a class="reference internal" href="referencias.html">REFERÊNCIAS BIBLIOGRÁFICAS</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/alexandrogschafer/Programacao-Geoprocessamento" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/alexandrogschafer/Programacao-Geoprocessamento/issues/new?title=Issue%20on%20page%20%2Fcapitulo4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/capitulo4.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>4. GEOPROCESSAMENTO BÁSICO COM SHAPELY E FIONA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-biblioteca-shapely">4.1 A biblioteca Shapely</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-geometrias-com-shapely">4.1.1 Criação de Geometrias com Shapely</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributos-geometrico-no-shapely">4.1.2 Atributos geométrico no Shapely</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcoes-geometricas-no-shapely">4.1.3 Funções geométricas no Shapely</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leitura-de-arquivos-com-fiona">4.2 Leitura de arquivos com Fiona</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leitura-de-arquivos-shapefile-com-fiona">4.2.1 Leitura de arquivos shapefile com Fiona</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulando-e-escrevendo-com-shapely-e-fiona">4.3 Manipulando e escrevendo com Shapely e Fiona</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="geoprocessamento-basico-com-shapely-e-fiona">
<h1>4. GEOPROCESSAMENTO BÁSICO COM SHAPELY E FIONA<a class="headerlink" href="#geoprocessamento-basico-com-shapely-e-fiona" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/Alexandrogschafer/Programacao-Geoprocessamento/blob/main/capitulo4.ipynb">Abrir no Google Colab</a></p>
<p>Dentro do ecossistema Python, existem diversas bibliotecas para otimizar o trabalho com dados geoespaciais. Dentre elas, Shapely e Fiona merecem destaque, não apenas por sua simplicidade, mas também pela eficácia com que lidam com tarefas geoespaciais. Quando utilizadas em conjunto, essas bibliotecas proporcionam uma abordagem integrada e robusta para o geoprocessamento básico no Python, tornando a análise e manipulação de dados espaciais mais acessível e eficiente.</p>
<section id="a-biblioteca-shapely">
<h2>4.1 A biblioteca Shapely<a class="headerlink" href="#a-biblioteca-shapely" title="Permalink to this heading">#</a></h2>
<p>Shapely é uma biblioteca Python para manipulação e análise de objetos geométricos planares. Baseada na biblioteca GEOS (usada em PostGIS e outros sistemas), ela oferece uma interface amigável para criar, manipular e analisar formas geométricas. As classes básicas são apresentadas na figura 5.</p>
<p><img alt="Figura 5" src="_images/fig5.png" /></p>
<p align="center">Figura 5: Classes para representar geometrias no Shapely</p>
<p>A Shapely destaca-se principalmente por suas capacidades geométricas. Ele facilita a execução de operações como união, interseção, diferença e buffer. Além disso, a biblioteca é essencial para manipular e transformar geometrias, desde a simplificação de linhas e polígonos até a criação de um convex hull em torno de pontos ou a divisão e combinação de diferentes formas geométricas.</p>
<section id="criacao-de-geometrias-com-shapely">
<h3>4.1.1 Criação de Geometrias com Shapely<a class="headerlink" href="#criacao-de-geometrias-com-shapely" title="Permalink to this heading">#</a></h3>
<p>Conforme apresentamos na figura 5, o Shapely oferece uma série de classes para representar diferentes tipos de geometrias. Vamos explorar como criar cada uma a seguir:</p>
<p>a) Point: Representa uma coordenada única no espaço.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">ponto</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d4cc77fe0a51c0e59d98b1af134a2a860ba0c042ffe3e5a8247c94902defe7fb.svg" src="_images/d4cc77fe0a51c0e59d98b1af134a2a860ba0c042ffe3e5a8247c94902defe7fb.svg" /></div>
</div>
<p>b) Linestring: Representa uma série de pontos conectados para formar uma linha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span>
<span class="n">linha</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">)])</span>
<span class="n">linha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e26409a015991ba6da94b450ba58144a3feffefb232209b238f20cd92406b29.svg" src="_images/0e26409a015991ba6da94b450ba58144a3feffefb232209b238f20cd92406b29.svg" /></div>
</div>
<p>c) Polygon: Representa uma área fechada. Você deve fornecer ao menos três coordenadas, e o primeiro e o último ponto devem ser os mesmos para fechar o polígono.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="n">poligono</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mf">5.1</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.4</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.6</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.1</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)])</span>
<span class="n">poligono</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f77acc48c976216576b41ba323c5afba825b3045bbd36ba8d9c3e8f26c49c4fb.svg" src="_images/f77acc48c976216576b41ba323c5afba825b3045bbd36ba8d9c3e8f26c49c4fb.svg" /></div>
</div>
<p>d) Polígono com furo: Refere-se a uma forma geométrica que consiste em um polígono externo maior e um ou mais polígonos internos menores que representam “furos” ou espaços vazios dentro do polígono maior. Estes polígonos internos são completamente contidos dentro do polígono externo e não se sobrepõem uns aos outros. Para criar um polígono com furos usando Shapely, você usaria a classe Polygon. A sintaxe básica é:</p>
<p>Definindo o polígono externo
<code class="docutils literal notranslate"><span class="pre">exterior</span> <span class="pre">=</span> <span class="pre">[(x1,</span> <span class="pre">y1),</span> <span class="pre">(x2,</span> <span class="pre">y2),</span> <span class="pre">...]</span></code></p>
<p>Definindo um ou mais polígonos internos (furos)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interior1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
<span class="n">interior2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Criando o polígono</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poligono_com_furos</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">exterior</span><span class="p">,</span> <span class="p">[</span><span class="n">interior1</span><span class="p">,</span> <span class="n">interior2</span><span class="p">])</span>
</pre></div>
</div>
<p>No código acima, exterior define os pontos do polígono externo, enquanto interior1 e interior2 definem os furos dentro do polígono externo. Você pode adicionar quantos “furos” quiser, simplesmente estendendo a lista de interiores. Exemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
</pre></div>
</div>
</div>
</div>
<p>Definindo as coordenadas para o anel externo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anel_externo</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Definindo as coordenadas para o anel interno</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anel_interno</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Criando o polígono com anel externo e interno</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poligono_com_furo</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">anel_externo</span><span class="p">,</span> <span class="p">[</span><span class="n">anel_interno</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Imprimindo o polígono</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poligono_com_furo</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5aba0b282baac6fec63e83bec97ebc40fd6eccd2b8df21ddd254527c67e12ec0.svg" src="_images/5aba0b282baac6fec63e83bec97ebc40fd6eccd2b8df21ddd254527c67e12ec0.svg" /></div>
</div>
<p>Multipoint: É uma coleção de vários pontos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiPoint</span>
<span class="n">multiponto</span> <span class="o">=</span> <span class="n">MultiPoint</span><span class="p">([(</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">)])</span>
<span class="n">multiponto</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cb2cf81367b94c41a526f1cd5636262ce12b52750d039c698744d50e2054b993.svg" src="_images/cb2cf81367b94c41a526f1cd5636262ce12b52750d039c698744d50e2054b993.svg" /></div>
</div>
<p>Multilinestring: É uma coleção de várias linhas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiLineString</span>
<span class="n">multilinha</span> <span class="o">=</span> <span class="n">MultiLineString</span><span class="p">([[(</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)],</span> <span class="p">[(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">)]])</span>
<span class="n">multilinha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8a81ab98560294b6cbe3b5ac55f5c566e43857e0a43673d2b1b0177714c68dd6.svg" src="_images/8a81ab98560294b6cbe3b5ac55f5c566e43857e0a43673d2b1b0177714c68dd6.svg" /></div>
</div>
<p>Multipolygon: É uma coleção de vários polígonos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiPolygon</span>
<span class="n">poligono1</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.6</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.1</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">)])</span>
<span class="n">poligono2</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">7.3</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">8.1</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">)])</span>
<span class="n">multipoligono</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">poligono1</span><span class="p">,</span> <span class="n">poligono2</span><span class="p">])</span>
<span class="n">multipoligono</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c5661ae57643c78fda8db204a0bca5390c7d6c683ebe587eba9b0d6c62e0c03a.svg" src="_images/c5661ae57643c78fda8db204a0bca5390c7d6c683ebe587eba9b0d6c62e0c03a.svg" /></div>
</div>
<p>GeometryCollection: É uma coleção de qualquer combinação de geometrias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">GeometryCollection</span>
<span class="n">colecao</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">([</span><span class="n">ponto</span><span class="p">,</span> <span class="n">linha</span><span class="p">,</span> <span class="n">poligono</span><span class="p">])</span>
<span class="n">colecao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5a42b5ba731f8276a6a7228b83fec2c205650e24ba7c9edbf9907c4fcab63040.svg" src="_images/5a42b5ba731f8276a6a7228b83fec2c205650e24ba7c9edbf9907c4fcab63040.svg" /></div>
</div>
</section>
<section id="atributos-geometrico-no-shapely">
<h3>4.1.2 Atributos geométrico no Shapely<a class="headerlink" href="#atributos-geometrico-no-shapely" title="Permalink to this heading">#</a></h3>
<p>O Shapely fornece uma variedade de atributos e métodos para interagir e analisar objetos geométricos. Quando falamos sobre “atributos geométricos” no contexto do Shapely, estamos nos referindo às propriedades intrínsecas de uma forma geométrica. Aqui estão alguns dos atributos geométricos mais comuns e úteis disponíveis no Shapely:</p>
<p>geom_type: Retorna o tipo de geometria do objeto, como “Point”, “Linestring”, “Polygon”, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ponto</span><span class="o">.</span><span class="n">geom_type</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Point
</pre></div>
</div>
</div>
</div>
<p>area: Retorna a área do objeto geométrico. Este atributo é relevante principalmente para polígonos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">poligono</span><span class="o">.</span><span class="n">area</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.36999999999999966
</pre></div>
</div>
</div>
</div>
<p>length: Para objetos Linestring, retorna o comprimento total da linha. Para objetos Polygon, retorna o comprimento total do perímetro.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">linha</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.4083314410864567
</pre></div>
</div>
</div>
</div>
<p>bounds: Retorna uma tupla com as coordenadas (minx, miny, maxx, maxy) que define a caixa delimitadora (bounding box) da geometria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">poligono</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5.1, 3.2, 6.6, 4.3)
</pre></div>
</div>
</div>
</div>
<p>is_valid: Verifica se a geometria é válida de acordo com as regras do plano euclidiano. Por exemplo, um polígono que se auto intersecciona não seria válido.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">poligono</span><span class="o">.</span><span class="n">is_valid</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>is_simple: Indica se a geometria não se auto intersecciona. Para a maioria das geometrias, isso é o mesmo que is_valid, mas existem alguns casos raros em que uma geometria pode ser válida, mas não simples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">linha</span><span class="o">.</span><span class="n">is_simple</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>centroid: Retorna o ponto central (ou “centroide”) da geometria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">poligono</span><span class="o">.</span><span class="n">centroid</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>POINT (6.033333333333334 3.8000000000000003)
</pre></div>
</div>
</div>
</div>
<p>exterior: Para polígonos, retorna o anel externo como um objeto LinearRing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">poligono</span><span class="o">.</span><span class="n">exterior</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LINEARRING (5.1 3.2, 6.4 4.3, 6.6 3.9, 5.1 3.2)
</pre></div>
</div>
</div>
</div>
<p>interiors: Para polígonos com furos, retorna uma sequência dos anéis internos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anel_externo</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">anel_interno</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">poli_com_furo</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">shell</span><span class="o">=</span><span class="n">anel_externo</span><span class="p">,</span> <span class="n">holes</span><span class="o">=</span><span class="p">[</span><span class="n">anel_interno</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">poli_com_furo</span><span class="o">.</span><span class="n">interiors</span><span class="p">))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;LINEARRING (1 1, 1 4, 4 4, 4 1, 1 1)&gt;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="funcoes-geometricas-no-shapely">
<h3>4.1.3 Funções geométricas no Shapely<a class="headerlink" href="#funcoes-geometricas-no-shapely" title="Permalink to this heading">#</a></h3>
<p>No Shapely, além dos atributos geométricos, existem várias funções ou métodos que permitem realizar operações geométricas. Essas funções são úteis para manipular, analisar e transformar geometrias. A seguir utilizaremos algumas das funções geométricas mais importantes no Shapely.</p>
<p>buffer: Cria um buffer ao redor de uma geometria com uma distância especificada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">ponto</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">buffer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/27529d936be41b00b7c4fc08030013fa4b1e6c6d452af60ea2d9841a802a12de.svg" src="_images/27529d936be41b00b7c4fc08030013fa4b1e6c6d452af60ea2d9841a802a12de.svg" /></div>
</div>
<p>union: Retorna a união geométrica entre geometrias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="n">pontoA</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pontoB</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bufferA</span> <span class="o">=</span> <span class="n">pontoA</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">bufferB</span> <span class="o">=</span> <span class="n">pontoB</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">uniao</span> <span class="o">=</span> <span class="n">bufferA</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bufferB</span><span class="p">)</span>
<span class="n">uniao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cdae93f309caba6b69a885795890ff826127d3ca606d8c620ef63bd467100c69.svg" src="_images/cdae93f309caba6b69a885795890ff826127d3ca606d8c620ef63bd467100c69.svg" /></div>
</div>
<p>intersection: Retorna a interseção geométrica entre geometrias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interseccao</span> <span class="o">=</span> <span class="n">bufferA</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">bufferB</span><span class="p">)</span>
<span class="n">interseccao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1cf6e0920cc05ee733046e30db004f7554eb99bc14dbd0317ae45257488f359f.svg" src="_images/1cf6e0920cc05ee733046e30db004f7554eb99bc14dbd0317ae45257488f359f.svg" /></div>
</div>
<p>difference: Retorna a diferença geométrica entre geometrias (subtrai a segunda geometria da primeira).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diferencaAB</span> <span class="o">=</span> <span class="n">bufferA</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">bufferB</span><span class="p">)</span>
<span class="n">diferencaAB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3c7b660d9f005086643d31dbd6af7454a49448b6f3647de5be1885b10733d469.svg" src="_images/3c7b660d9f005086643d31dbd6af7454a49448b6f3647de5be1885b10733d469.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diferencaBA</span> <span class="o">=</span> <span class="n">bufferB</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">bufferA</span><span class="p">)</span>
<span class="n">diferencaBA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b9a9f9ee40d409491fd2b8aa4512d2d173dc107d765ce1cd86083609ef3cfa38.svg" src="_images/b9a9f9ee40d409491fd2b8aa4512d2d173dc107d765ce1cd86083609ef3cfa38.svg" /></div>
</div>
<p>symmetric_difference: Retorna as partes de duas geometrias que não são compartilhadas entre si.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dif_simetrica</span> <span class="o">=</span> <span class="n">bufferA</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">bufferB</span><span class="p">)</span>
<span class="n">dif_simetrica</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/15e9bc4f3b3d2dbc4043973cd7bcb57bd583ac83b7cff5bd6e3b8bf63646e070.svg" src="_images/15e9bc4f3b3d2dbc4043973cd7bcb57bd583ac83b7cff5bd6e3b8bf63646e070.svg" /></div>
</div>
<p>contains: Verifica se uma geometria contém a outra geometria fornecida.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bufferA</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>intersects: Verifica se uma geometria intercepta a outra geometria fornecida.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bufferA</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">bufferB</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>crosses: Verifica se uma geometria cruza a outra (aplicável principalmente com linhas).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span>
<span class="n">linha1</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<span class="n">linha2</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linha1</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">linha2</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>distance: Calcula a distância mínima entre as geometrias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distancia</span> <span class="o">=</span> <span class="n">pontoB</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">bufferA</span><span class="p">)</span>  
<span class="n">distancia</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<p>envelope: Retorna o menor retângulo delimitador que contém uma geometria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">envelope</span> <span class="o">=</span> <span class="n">bufferA</span><span class="o">.</span><span class="n">envelope</span>
<span class="n">envelope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f5bc8e2c5925be5f22d4dbef4377666a3df9de0d0df7165e9d669b3f181e601a.svg" src="_images/f5bc8e2c5925be5f22d4dbef4377666a3df9de0d0df7165e9d669b3f181e601a.svg" /></div>
</div>
<p><img alt="Figura 6" src="_images/fig6.png" /></p>
<p align="center">Figura 6: Visualização do buffer e do respectivo envelope</p>
</section>
</section>
<section id="leitura-de-arquivos-com-fiona">
<h2>4.2 Leitura de arquivos com Fiona<a class="headerlink" href="#leitura-de-arquivos-com-fiona" title="Permalink to this heading">#</a></h2>
<p>A maneira como os dados espaciais são armazenados é diferente dos arquivos de texto ou binários comuns. Desta maneira, abrir um arquivo geoespacial (como um shapefile, GeoJSON, entre outros) requer uma interpretação especializada das estruturas de dados contidas no arquivo.</p>
<p>O Fiona fornece a interface e as funcionalidades necessárias para ler e escrever dados geoespaciais em Python. Ele se baseia no conjunto de bibliotecas GDAL/OGR e fornece uma maneira “pythonic” de manipular arquivos de formato vetorial. Uma vez que os dados são lidos com Fiona, as geometrias podem ser facilmente convertidas em objetos Shapely para análise e manipulação geométrica.</p>
<section id="leitura-de-arquivos-shapefile-com-fiona">
<h3>4.2.1 Leitura de arquivos shapefile com Fiona<a class="headerlink" href="#leitura-de-arquivos-shapefile-com-fiona" title="Permalink to this heading">#</a></h3>
<p>O shapefile é um formato de arquivo popular para armazenar informações geográficas, amplamente utilizado em Sistemas de Informações Geográficas (SIG ou GIS, em inglês). Embora existam outros formatos (como GeoJSON, GML, KML) que são mais modernos e flexíveis em muitos aspectos, o formato shapefile pode ser considerado o padrão na área de SIG atualmente.
Além das informações geográficas (coordenadas que definem a geometria), cada objeto em um shapefile pode ter um conjunto de atributos associado. Além disso, um shapefile pode (e geralmente tem) um sistema de referência de coordenadas associado, que define o sistema de projeção.</p>
<p>É importante ressaltar que o shapefile é, na realidade, um conjunto de arquivos que trabalham juntos para representar e armazenar informações geográficas e seus atributos. Existem três arquivos principais, essenciais para que o shapefile funcione corretamente, e vários outros arquivos auxiliares que podem acompanhar um shapefile dependendo das características e necessidades do conjunto de dados. No quadro 6 apresenta-se os principais arquivos que podem constituir um shapefile.</p>
<p>Arquivos que podem constituir um shapefile.</p>
<p>Quadro 8: Extensões obrigatórias</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Extensão</p></th>
<th class="head"><p>Descrição</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>shp</p></td>
<td><p>Contém a geometria dos objetos, por exemplo, pontos, linhas ou polígonos.</p></td>
</tr>
<tr class="row-odd"><td><p>shx</p></td>
<td><p>É o índice da geometria. Ele fornece um índice para os objetos no arquivo .shp, permitindo um acesso mais rápido a eles.</p></td>
</tr>
<tr class="row-even"><td><p>dbf</p></td>
<td><p>Contém os atributos para cada objeto em uma tabela. Cada linha da tabela corresponde a um objeto no arquivo .shp e cada coluna é um atributo desse objeto.</p></td>
</tr>
</tbody>
</table>
<p>Quadro 9: Extensões auxiliares</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Extensão</p></th>
<th class="head"><p>Descrição</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>prj</p></td>
<td><p>Contém informações sobre a projeção e o sistema de coordenadas em que os dados estão definidos.</p></td>
</tr>
<tr class="row-odd"><td><p>sbn</p></td>
<td><p>São arquivos de índice espacial. Eles podem ser usados por alguns sistemas SIG para renderizar e consultar dados mais rapidamente.</p></td>
</tr>
<tr class="row-even"><td><p>sbx</p></td>
<td><p>São arquivos de índice espacial. Eles podem ser usados por alguns sistemas SIG para renderizar e consultar dados mais rapidamente.</p></td>
</tr>
<tr class="row-odd"><td><p>qix</p></td>
<td><p>É um arquivo de índice espacial opcional criado por algumas ferramentas, como o QGIS, para acelerar operações espaciais.</p></td>
</tr>
<tr class="row-even"><td><p>lyr</p></td>
<td><p>É um arquivo utilizado pelo ArcGIS para armazenar informações sobre a simbologia e a visualização do shapefile.</p></td>
</tr>
<tr class="row-odd"><td><p>cpg</p></td>
<td><p>Contém informações sobre a codificação de caracteres para o arquivo .dbf, o que pode ser importante para a exibição correta de caracteres especiais ou não ASCII.</p></td>
</tr>
<tr class="row-even"><td><p>atx</p></td>
<td><p>É um arquivo de índice criado pelo ArcGIS para campos específicos na tabela de atributos, acelerando determinadas operações.</p></td>
</tr>
</tbody>
</table>
<p>Existem outros arquivos que podem, ocasionalmente, estar associados a um shapefile, especialmente quando se trabalha com softwares específicos que criam arquivos de índice ou metadados adicionais. No entanto, os listados acima são os mais comuns. Vale lembrar que para transferir ou mover um shapefile, é importante manter pelo menos os três arquivos principais juntos (.shp, .shx e .dbf) para garantir a integridade dos dados.</p>
<p>O código a seguir é um exemplo de como ler um arquivo shapefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="c1"># Abre o arquivo shapefile</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;caminho_para_seu_arquivo.shp&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">registro</span><span class="p">:</span>
    <span class="c1"># Imprime o tipo de geometria (Ex.: &#39;Point&#39;, &#39;LineString&#39;, &#39;Polygon&#39;)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">registro</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
    <span class="c1"># Itera sobre cada recurso no shapefile</span>

    <span class="k">for</span> <span class="n">entidade</span> <span class="ow">in</span> <span class="n">registro</span><span class="p">:</span>
        <span class="c1"># &#39;entidade&#39; é um dicionário com os atributos e a geometria</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">entidade</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>  <span class="c1"># geometria</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">entidade</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span>  <span class="c1"># atributos</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
</pre></div>
</div>
<p>Vamos entender o que cada parte do código faz:</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">fiona</span></code></p>
<p>A primeira linha importa a biblioteca fiona.</p>
<p><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">fiona.open('caminho_para_seu_arquivo.shp',</span> <span class="pre">'r')</span> <span class="pre">as</span> <span class="pre">registro:</span></code></p>
<p>A função fiona.open é usada para abrir um arquivo shapefile. O argumento ‘r’ indica que o arquivo está sendo aberto no modo de leitura (read). A instrução with é usada aqui para garantir que o arquivo seja fechado corretamente após sua utilização, independentemente de ocorrerem erros durante a execução do código.</p>
<p><code class="docutils literal notranslate"><span class="pre">print(registro.schema['geometry'])</span></code></p>
<p>Imprime o tipo de geometria do shapefile, que pode ser, por exemplo, ‘Point’, ‘Linestring’ ou ‘Polygon’. registro.schema é um dicionário que descreve os atributos e a geometria do shapefile.</p>
<p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">entidade</span> <span class="pre">in</span> <span class="pre">registro:</span></code></p>
<p>Este é um loop que itera sobre cada registro no shapefile.</p>
<p><code class="docutils literal notranslate"><span class="pre">geom</span> <span class="pre">=</span> <span class="pre">entidade['geometry']</span>&#160; <span class="pre">#</span> <span class="pre">geometria</span></code></p>
<p>Aqui, a geometria de cada registro é extraída. A geometria pode ser um ponto, uma linha, um polígono, etc.</p>
<p><code class="docutils literal notranslate"><span class="pre">props</span> <span class="pre">=</span> <span class="pre">entidade['properties']</span>&#160; <span class="pre">#</span> <span class="pre">atributos</span></code></p>
<p>Aqui, os atributos associados a cada recurso são extraídos. Os atributos são os dados associados a cada geometria, como nomes, valores, categorias, etc.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
</pre></div>
</div>
<p>Esse código imprime a geometria e os atributos de cada registro.</p>
<p>Quando você usa a biblioteca fiona para abrir e ler um shapefile, vários processos ocorrem internamente. Aqui está uma visão geral do que acontece:</p>
<p>Abertura do Arquivo: Quando você chama fiona.open(), a biblioteca primeiramente localiza e abre o arquivo shapefile para leitura;
Leitura dos Metadados: Uma vez que o arquivo é aberto, fiona começa lendo os metadados associados ao shapefile. Isso inclui informações sobre o sistema de coordenadas, o tipo de geometria (pontos, linhas, polígonos, etc.) e a estrutura do arquivo de atributos (campos, tipos de dados, etc.);</p>
<p>Interface Iterável: A biblioteca fornece uma interface iterável sobre os registros no shapefile. Cada registro contém uma geometria e um conjunto associado de atributos;</p>
<p>Acesso Direto à Geometria e Atributos: Ao iterar sobre os registros, você pode acessar diretamente as geometrias e os atributos de cada registro. Fiona retorna geometrias no formato GeoJSON e permite que você interaja com os atributos como se estivesse trabalhando com um dicionário em Python;</p>
<p>Conversão de Geometrias: Embora as geometrias retornem no formato GeoJSON, elas são compatíveis com a biblioteca shapely. Isto significa que você pode convertê-las em objetos shapely para análise e manipulação geométrica mais avançada;</p>
<p>Fechamento Automático: Se você usar fiona dentro de um bloco with (como é recomendado), o arquivo será automaticamente fechado quando o bloco for concluído. Isso garante que os recursos do sistema sejam liberados e que não haja bloqueios no arquivo;</p>
<p>Manipulação de Erros: Durante todo o processo, fiona tem mecanismos para lidar com erros. Se houver algum problema com o arquivo (por exemplo, se estiver corrompido ou faltando componentes), fiona geralmente lançará um erro explicativo.</p>
<p>Obtendo metadados do arquivo
Os metadados de um shapefile referem-se a informações sobre o próprio shapefile, como o sistema de coordenadas em que os dados estão projetados, o tipo de geometria (pontos, linhas ou polígonos) e outras informações que descrevem o conteúdo, qualidade, condição, e outras características do arquivo. Em muitos casos, os metadados são vitais para a correta interpretação e uso dos dados no shapefile. Sem metadados adequados, um usuário pode interpretar mal os dados, levando a decisões ou análises incorretas.</p>
<p>Os metadados de um arquivo shapefile utilizando Fiona podem ser obtidos utilizando o seguinte código:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;caminho_para_seu_arquivo.shp&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">registro</span><span class="p">:</span>
    <span class="c1"># Sistema de coordenadas</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="n">registro</span><span class="o">.</span><span class="n">crs</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRS:&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

    <span class="c1"># Limites do conjunto de dados</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">registro</span><span class="o">.</span><span class="n">bounds</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ext_espacial:&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>

    <span class="c1"># Total de recursos no arquivo</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">registro</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total de registros:&#39;</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
<p>Nesse código, fiona.open() é usado para abrir e ler o arquivo shapefile; registro.crs fornece o Sistema de Referência de Coordenadas (CRS) do shapefile; registro.bounds retorna uma tupla com os limites do conjunto de dados: (minx, miny, maxx, maxy), onde minx e miny são as coordenadas mínimas x e y, e maxx e maxy são as coordenadas máximas x e y; len(registro) retorna o número total de recursos no arquivo shapefile, ou seja, a quantidade de objetos que ele contém.</p>
<p>Exemplo: Vamos abrir o shapefile “BR_UF.shp”, constituído por polígonos referentes a cada estado brasileiro (figura 7) e pelos atributos que constam na figura 8.</p>
<p><img alt="Figura 7" src="_images/fig7.png" /></p>
<p align="center">Figura 7: Visualização do arquivo shapefile BR_UF.</p>
<p><img alt="Figura 8" src="_images/fig8.png" /></p>
<p align="center">Figura 8: Visualização parcial da tabela de atributos de BR_UF.</p>
<p>Vamos utilizar o script abaixo para abrir o shapefile, ler as geometrias do tipo Polygon e imprimir os atributos CD_UF, NM_UF e SIGLA_UF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">home_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>
<span class="n">shp_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_dir</span><span class="p">,</span> <span class="s1">&#39;geopythonbook/content/4_br_uf/BR_UF.shp&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">fiona</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">shp_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">registro</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">registro</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">entidade</span> <span class="ow">in</span> <span class="n">registro</span><span class="p">:</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">entidade</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>  
        <span class="n">props</span> <span class="o">=</span> <span class="n">entidade</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span> 
        
        <span class="c1"># Extrai os atributos desejados</span>
        <span class="n">id_estado</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;CD_UF&#39;</span><span class="p">]</span>
        <span class="n">nome</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;NM_UF&#39;</span><span class="p">]</span>
        <span class="n">sigla</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;SIGLA_UF&#39;</span><span class="p">]</span>
            
        <span class="c1"># Imprime os atributos</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ID: </span><span class="si">{</span><span class="n">id_estado</span><span class="si">}</span><span class="s1">, Nome: </span><span class="si">{</span><span class="n">nome</span><span class="si">}</span><span class="s1">, Sigla: </span><span class="si">{</span><span class="n">sigla</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Polygon
ID: 12, Nome: Acre, Sigla: AC
ID: 13, Nome: Amazonas, Sigla: AM
ID: 15, Nome: Pará, Sigla: PA
ID: 16, Nome: Amapá, Sigla: AP
ID: 17, Nome: Tocantins, Sigla: TO
ID: 21, Nome: Maranhão, Sigla: MA
ID: 22, Nome: Piauí, Sigla: PI
ID: 23, Nome: Ceará, Sigla: CE
ID: 24, Nome: Rio Grande do Norte, Sigla: RN
ID: 25, Nome: Paraíba, Sigla: PB
ID: 26, Nome: Pernambuco, Sigla: PE
ID: 27, Nome: Alagoas, Sigla: AL
ID: 28, Nome: Sergipe, Sigla: SE
ID: 29, Nome: Bahia, Sigla: BA
ID: 31, Nome: Minas Gerais, Sigla: MG
ID: 32, Nome: Espírito Santo, Sigla: ES
ID: 33, Nome: Rio de Janeiro, Sigla: RJ
ID: 35, Nome: São Paulo, Sigla: SP
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ID: 41, Nome: Paraná, Sigla: PR
ID: 42, Nome: Santa Catarina, Sigla: SC
ID: 43, Nome: Rio Grande do Sul, Sigla: RS
ID: 50, Nome: Mato Grosso do Sul, Sigla: MS
ID: 51, Nome: Mato Grosso, Sigla: MT
ID: 52, Nome: Goiás, Sigla: GO
ID: 53, Nome: Distrito Federal, Sigla: DF
ID: 11, Nome: Rondônia, Sigla: RO
ID: 14, Nome: Roraima, Sigla: RR
</pre></div>
</div>
</div>
</div>
<p>Aplicando o script de consulta de metadados, obtemos:</p>
<p>O EPSG 4326 é um código de sistema de referência espacial (SRS) que se refere ao sistema WGS 84 (World Geodetic System 1984). EPSG significa “European Petroleum Survey Group”. Originalmente era um grupo de trabalho dedicado à aplicação da geodésia e da cartografia na indústria de petróleo e gás na Europa.</p>
<p>O grupo criou e mantém uma base de dados com códigos para sistemas de referência espacial, transformações de coordenadas, unidades e métodos relacionados. Este banco de dados é amplamente utilizado em software GIS e outras aplicações geoespaciais. “4326” é o código específico no banco de dados EPSG que se refere ao WGS 84 com coordenadas em latitude e longitude (em graus decimais).</p>
</section>
</section>
<section id="manipulando-e-escrevendo-com-shapely-e-fiona">
<h2>4.3 Manipulando e escrevendo com Shapely e Fiona<a class="headerlink" href="#manipulando-e-escrevendo-com-shapely-e-fiona" title="Permalink to this heading">#</a></h2>
<p>Escrever dados espaciais usando as bibliotecas Shapely e Fiona é uma tarefa comum em aplicações de geoprocessamento com Python. A Shapely é utilizada para manipular e analisar dados geométricos, enquanto a Fiona é usada para ler e escrever dados geoespaciais. Vamos criar um exemplo simples para demonstrar como escrever um shapefile contendo pontos usando Shapely e Fiona:</p>
<p>Exemplo 1: Criar um shapefile contendo um único ponto (5,5) com as propriedades ‘ID’ e ‘NOME’. Você pode estender o exemplo adicionando mais pontos ou outras geometrias e propriedades, conforme sua necessidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">mapping</span>

<span class="c1"># Define a estrutura do shapefile</span>
<span class="n">esquema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;nome&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Caminho e nome para o novo shapefile</span>
<span class="n">shapefile_saida</span> <span class="o">=</span> <span class="s1">&#39;pontos_saida.shp&#39;</span>

<span class="c1"># Cria um novo shapefile</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">shapefile_saida</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">esquema</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>

    <span class="c1"># Exemplo de dados: um ponto com coordenadas (5,5) e algumas propriedades</span>
    <span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">propriedades</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nome&#39;</span><span class="p">:</span> <span class="s1">&#39;Ponto de exemplo&#39;</span><span class="p">}</span>
    
    <span class="c1"># Escreve o ponto no shapefile</span>
    <span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">ponto</span><span class="p">),</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">propriedades</span>
    <span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shapefile </span><span class="si">{</span><span class="n">shapefile_saida</span><span class="si">}</span><span class="s1"> criado com sucesso!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shapefile pontos_saida.shp criado com sucesso!
</pre></div>
</div>
</div>
</div>
<p>Vamos entender cada parte do código:</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">fiona</span> </code></p>
<p>Importa a biblioteca Fiona, que é usada para a leitura e escrita de arquivos geoespaciais.</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">shapely.geometry</span> <span class="pre">import</span> <span class="pre">Point,</span> <span class="pre">mapping</span> </code></p>
<p>Importa a classe Point da biblioteca Shapely, que é usada para criar geometrias de ponto. A função mapping é usada para converter geometrias Shapely em um formato que Fiona possa entender.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esquema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Um dicionário chamado esquema é definido para especificar a estrutura do shapefile. Indica que o shapefile conterá geometrias do tipo ponto (‘geometry’: ‘Point’) e terá duas propriedades/atributos: id (um número inteiro) e name (uma string).</p>
<p><code class="docutils literal notranslate"><span class="pre">shapefile_saida</span> <span class="pre">=</span> <span class="pre">'pontos_saida.shp'</span></code>
Especifica o nome e o caminho do novo shapefile que será criado: shapefile_saida.</p>
<p><code class="docutils literal notranslate"> <span class="pre">with</span> <span class="pre">fiona.open(shapefile_saida,</span> <span class="pre">'w',</span> <span class="pre">'ESRI</span> <span class="pre">Shapefile',</span> <span class="pre">esquema)</span> <span class="pre">as</span> <span class="pre">c:</span></code>
Aqui, o comando fiona.open é usado com o argumento ‘w’ (para escrita) para criar um novo shapefile. Também especifica o formato do arquivo (‘ESRI Shapefile’) e o esquema previamente definido.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">propriedades</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;NOME&#39;</span><span class="p">:</span> <span class="s1">&#39;Ponto de exemplo&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Um objeto de ponto é criado usando a classe Point da biblioteca Shapely, e as propriedades associadas a esse ponto são armazenadas no dicionário “propriedades”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">ponto</span><span class="p">),</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">propriedades</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>O ponto e suas propriedades são escritos no shapefile. A função mapping é usada para converter o objeto de ponto em um formato que Fiona possa entender e escrever no arquivo.</p>
<p><code class="docutils literal notranslate"><span class="pre">print(f'Shapefile</span> <span class="pre">{shapefile_saida}</span> <span class="pre">criado</span> <span class="pre">com</span> <span class="pre">sucesso!')</span></code></p>
<p>Uma mensagem é impressa para confirmar que o shapefile foi criado com sucesso.</p>
<p>Você pode visualizar os arquivos criados na aba files, na lateral esquerda do ambiente do Google Colab.</p>
<p>Lembre-se de que ao trabalhar com shapefiles, além do arquivo .shp, outros arquivos (como .shx e .dbf) também são gerados. Se você decidir mover ou compartilhar seu shapefile, certifique-se de incluir esses arquivos auxiliares.</p>
<p>Exemplo 2: Criar um shapefile com as capitais do Brasil, com geometrias do tipo ponto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">from</span> <span class="nn">fiona.crs</span> <span class="kn">import</span> <span class="n">from_epsg</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="n">esquema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;estado&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Nesse código, importamos as bibliotecas e definimos a estrutura do arquivo shapefile. O campo geometry define que o arquivo conterá pontos (Point). O campo properties especifica que cada ponto terá dois atributos associados: capital (o nome da capital) e estado (o nome do estado), ambos do tipo string (str).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capitais</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Brasília&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Distrito Federal&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">47.8825</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.7934</span><span class="p">)),</span>
    <span class="s1">&#39;Rio Branco&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Acre&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">67.8270</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.97499</span><span class="p">)),</span>
    <span class="s1">&#39;Maceió&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Alagoas&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.7353</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.66599</span><span class="p">)),</span>
    <span class="s1">&#39;Manaus&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Amazonas&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0253</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.11333</span><span class="p">)),</span>
    <span class="s1">&#39;Macapá&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Amapá&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">51.0705</span><span class="p">,</span> <span class="mf">0.039452</span><span class="p">)),</span>
    <span class="s1">&#39;Salvador&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Bahia&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">38.5014</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.9714</span><span class="p">)),</span>
    <span class="s1">&#39;Fortaleza&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Ceará&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">38.5423</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.71722</span><span class="p">)),</span>
    <span class="s1">&#39;Vitória&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Espírito Santo&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">40.2976</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.3195</span><span class="p">)),</span>
    <span class="s1">&#39;Goiânia&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Goiás&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">49.2539</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.6869</span><span class="p">)),</span>
    <span class="s1">&#39;São Luís&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Maranhão&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">44.3028</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.52996</span><span class="p">)),</span>
    <span class="s1">&#39;Cuiabá&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Mato Grosso&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">56.0974</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.6014</span><span class="p">)),</span>
    <span class="s1">&#39;Campo Grande&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Mato Grosso do Sul&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">54.6156</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.4428</span><span class="p">)),</span>
    <span class="s1">&#39;Belo Horizonte&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Minas Gerais&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">43.9378</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.9208</span><span class="p">)),</span>
    <span class="s1">&#39;Belém&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Pará&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">48.4874</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4554</span><span class="p">)),</span>
    <span class="s1">&#39;João Pessoa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Paraíba&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">34.8761</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.11509</span><span class="p">)),</span>
    <span class="s1">&#39;Curitiba&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Paraná&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">49.2713</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.4296</span><span class="p">)),</span>
    <span class="s1">&#39;Recife&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Pernambuco&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">34.8813</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.05428</span><span class="p">)),</span>
    <span class="s1">&#39;Teresina&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Piauí&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">42.8056</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.09194</span><span class="p">)),</span>
    <span class="s1">&#39;Rio de Janeiro&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Rio de Janeiro&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">43.1965</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.9083</span><span class="p">)),</span>
    <span class="s1">&#39;Natal&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Rio Grande do Norte&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.2091</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.79448</span><span class="p">)),</span>
    <span class="s1">&#39;Porto Alegre&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Rio Grande do Sul&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">51.2167</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0277</span><span class="p">)),</span>
    <span class="s1">&#39;Porto Velho&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Rondônia&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">63.9004</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.76077</span><span class="p">)),</span>
    <span class="s1">&#39;Boa Vista&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Roraima&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.6733</span><span class="p">,</span> <span class="mf">2.81972</span><span class="p">)),</span>
    <span class="s1">&#39;Florianópolis&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Santa Catarina&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">48.5012</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.5954</span><span class="p">)),</span>
    <span class="s1">&#39;São Paulo&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;São Paulo&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">46.6395</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.5475</span><span class="p">)),</span>
    <span class="s1">&#39;Aracaju&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Sergipe&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">37.0763</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.9873</span><span class="p">)),</span>
    <span class="s1">&#39;Palmas&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Tocantins&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">48.3344</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.2391</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Com este código, criamos um dicionário chamado “capitais”. As chaves do dicionário são os nomes das capitais e os valores são tuplas que contêm o nome do estado e as coordenadas (longitude e latitude) da respectiva capital.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Neste trecho, o código inicia o processo de criação do arquivo shapefile usando a biblioteca fiona. O arquivo será salvo como &#39;capitais_br.shp&#39;. O CRS (Sistema de Referência de Coordenadas) utilizado é o EPSG 4326.</span>

<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;capitais_br.shp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="n">esquema</span><span class="p">)</span> <span class="k">as</span> <span class="n">layer</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">capital</span><span class="p">,</span> <span class="p">(</span><span class="n">estado</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="ow">in</span> <span class="n">capitais</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">propriedades</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
                <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="n">coords</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="n">capital</span><span class="p">,</span>
                <span class="s1">&#39;estado&#39;</span><span class="p">:</span> <span class="n">estado</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">propriedades</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR 1: PROJ: internal_proj_create_from_database: /home/alexandro/anaconda3/share/proj/proj.db lacks DATABASE.LAYOUT.VERSION.MAJOR / DATABASE.LAYOUT.VERSION.MINOR metadata. It comes from another PROJ installation.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CPLE_AppDefinedError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">fiona/crs.pyx</span> in <span class="ni">fiona.crs.CRS.from_epsg</span><span class="nt">()</span>

<span class="nn">fiona/_err.pyx</span> in <span class="ni">fiona._err.exc_wrap_int</span><span class="nt">()</span>

<span class="ne">CPLE_AppDefinedError</span>: PROJ: internal_proj_create_from_database: /home/alexandro/anaconda3/share/proj/proj.db lacks DATABASE.LAYOUT.VERSION.MAJOR / DATABASE.LAYOUT.VERSION.MINOR metadata. It comes from another PROJ installation.

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">CRSError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_24658</span><span class="o">/</span><span class="mf">2240429878.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Neste trecho, o código inicia o processo de criação do arquivo shapefile usando a biblioteca fiona. O arquivo será salvo como &#39;capitais_br.shp&#39;. O CRS (Sistema de Referência de Coordenadas) utilizado é o EPSG 4326.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;capitais_br.shp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="n">esquema</span><span class="p">)</span> <span class="k">as</span> <span class="n">layer</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">for</span> <span class="n">capital</span><span class="p">,</span> <span class="p">(</span><span class="n">estado</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="ow">in</span> <span class="n">capitais</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="n">ponto</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="nn">fiona/crs.pyx</span> in <span class="ni">fiona.crs.from_epsg</span><span class="nt">()</span>

<span class="nn">fiona/crs.pyx</span> in <span class="ni">fiona.crs.CRS.from_epsg</span><span class="nt">()</span>

<span class="ne">CRSError</span>: The EPSG code is unknown. PROJ: internal_proj_create_from_database: /home/alexandro/anaconda3/share/proj/proj.db lacks DATABASE.LAYOUT.VERSION.MAJOR / DATABASE.LAYOUT.VERSION.MINOR metadata. It comes from another PROJ installation.
</pre></div>
</div>
</div>
</div>
<p>Nesse código, iteramos sobre o dicionário capitais. Para cada capital, ele cria um objeto Point com as coordenadas. Em seguida, ele cria um dicionário propriedades que contém as informações geométricas e os atributos associados. Esse dicionário é então escrito (adicionado) no arquivo shapefile usando o método write.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shapefile criado com sucesso!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, o código imprime uma mensagem indicando que o arquivo shapefile foi criado com sucesso.
Na figura 9 podemos visualizar os pontos referentes as capitais provenientes do arquivo shapefile criado.</p>
<p><img alt="Figura 9" src="_images/fig9.png" /></p>
<p align="center">Figura 9: Visualização dos pontos referentes às capitais dos estados brasileiros.</p>
<p>Exemplo 3: Escrever um arquivo em formato GeoJSON</p>
<p>O GeoJSON é um formato de intercâmbio de dados geoespaciais, baseado no JSON (JavaScript Object Notation). Foi desenvolvido para representar objetos geográficos simples, juntamente com seus atributos não espaciais. Devido à simplicidade e à crescente adoção de tecnologias baseadas em web para aplicações geoespaciais, o GeoJSON vem se tornando um dos formatos padrão para transmissão de dados geoespaciais na web.</p>
<p>O GeoJSON suporta vários tipos de geometria, incluindo Point (ponto), Linestring (linha), Polygon (polígono), Multipoint, Multilinestring, e Multipolygon. Além disso, ele suporta GeometryCollection, que, como vimos, é uma coleção de geometrias. Além da geometria, cada objeto GeoJSON pode ter atributos associados. Estes são armazenados em um objeto chamado propriedades. As coordenadas em GeoJSON são sempre em longitude e latitude (e opcionalmente altitude), e são representadas no formato decimal.</p>
<p>Para criar um arquivo GeoJSON no fiona, é necessário alterar o argumento driver para “GeoJSON” quando você abrir o arquivo para escrita com fiona.open(). Esse argumento especifica o formato desejado, que neste caso é GeoJSON.
with fiona.open(arquivo_saida, ‘w’, driver=’GeoJSON’, schema=esquema) as c:</p>
<p>Vamos criar um arquivo GeoJSON contendo uma linha definida a partir de três pontos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">mapping</span>

<span class="c1"># Define a estrutura do GeoJSON</span>
<span class="n">esquema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;LineString&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Caminho e nome para o novo GeoJSON</span>
<span class="n">arquivo_saida</span> <span class="o">=</span> <span class="s1">&#39;linhas_saida.geojson&#39;</span>

<span class="c1"># Cria um novo arquivo GeoJSON</span>

<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">arquivo_saida</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">esquema</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    
    <span class="c1"># Exemplo de dados: uma linha com coordenadas [(0,0), (5,5), (10,10)] e algumas propriedades</span>
    <span class="n">linha</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
    <span class="n">propriedades</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;Linha Exemplo&#39;</span><span class="p">}</span>
    
    <span class="c1"># Escreve a linha no GeoJSON</span>
    <span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">linha</span><span class="p">),</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">propriedades</span><span class="p">,</span>
    <span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Arquivo GeoJSON </span><span class="si">{</span><span class="n">arquivo_saida</span><span class="si">}</span><span class="s1"> criado com sucesso!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Exemplo 4: Escrever um arquivo shapefile com geometrias do tipo polígono</p>
<p>Para escrever um shapefile contendo polígonos, utilizaremos a mesma sintaxe dos exemplos anteriores, usando Shapely para a criação das geometrias e Fiona para a escrita dos dados em formato shapefile:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">mapping</span>

<span class="c1"># Define a estrutura do shapefile</span>
<span class="n">esquema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Caminho e nome para o novo shapefile</span>
<span class="n">arquivo_saida</span> <span class="o">=</span> <span class="s1">&#39;poligonos_saida.shp&#39;</span>

<span class="c1"># Cria um novo shapefile</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">arquivo_saida</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">esquema</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    
    <span class="c1"># Exemplo de dados: um polígono com coordenadas [(0,0), (5,5), (10,0), (0,0)] </span>
    <span class="c1">#e algumas propriedades</span>
    <span class="n">poligono</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
    <span class="n">propriedades</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;Polígono Exemplo&#39;</span><span class="p">}</span>
    
    <span class="c1"># Escreve o polígono no shapefile</span>
    <span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">(</span><span class="n">poligono</span><span class="p">),</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">propriedades</span><span class="p">,</span>
    <span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shapefile </span><span class="si">{</span><span class="n">arquivo_saida</span><span class="si">}</span><span class="s1"> criado com sucesso!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Você pode visualizar os arquivos criados na aba files, na lateral esquerda do ambiente do Google Colab.</p>
<p>É possível estender o exemplo acima para adicionar mais polígonos ou outras propriedades conforme a necessidade. Novamente, lembre-se de que shapefiles são compostos por múltiplos arquivos (.shp, .shx, .dbf, entre outros). Ao mover ou compartilhar seu shapefile, não se esqueça de incluir todos os arquivos auxiliares.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="capitulo3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">3. A BIBLIOTECA PANDAS</p>
      </div>
    </a>
    <a class="right-next"
       href="capitulo5.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">5 A BIBLIOTECA GEOPANDAS</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-biblioteca-shapely">4.1 A biblioteca Shapely</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-geometrias-com-shapely">4.1.1 Criação de Geometrias com Shapely</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributos-geometrico-no-shapely">4.1.2 Atributos geométrico no Shapely</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcoes-geometricas-no-shapely">4.1.3 Funções geométricas no Shapely</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leitura-de-arquivos-com-fiona">4.2 Leitura de arquivos com Fiona</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leitura-de-arquivos-shapefile-com-fiona">4.2.1 Leitura de arquivos shapefile com Fiona</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulando-e-escrevendo-com-shapely-e-fiona">4.3 Manipulando e escrevendo com Shapely e Fiona</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alexandro Gularte Schafer
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>